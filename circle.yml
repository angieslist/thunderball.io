machine:
  node:
    version: 8
  environment:
    PATH: "${PATH}:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin"

dependencies:
  cache_directories:
    - node_modules
    - ./packages/eslint-plugin-thunderball/node_modules
    - ./packages/generator-thunderball/node_modules
    - ./packages/thunderball-client/node_modules
    - ./packages/thunderball-hello-world/node_modules
    - ./packages/thunderball/node_modules

  override:
    - npm config set package-lock false
    - npm install
    - npm run bootstrap
    - NODE_ENV=production npm run build

test:
  override:
    - npm run test-ci
    - cd ./packages/thunderball-hello-world && gulp build -p && cd ../..
    - npm run test-e2e

  post:
    - cp -v test-report.xml $CIRCLE_TEST_REPORTS
    - cp -vR coverage $CIRCLE_ARTIFACTS

general:
  branches:
    ignore:
      - gh-pages
